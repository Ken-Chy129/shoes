<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ken.shoes.mapper.SearchTaskMapper">

    <select id="selectByCondition" resultType="cn.ken.shoes.model.entity.SearchTaskDO">
        select * from search_task
        <where>
            <if test="platform != null and platform != ''">
                and platform = #{platform}
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
        </where>
        order by gmt_create desc
        limit #{startIndex}, #{pageSize}
    </select>

    <select id="count" resultType="java.lang.Long">
        select count(*) from search_task
        <where>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
        </where>
    </select>

    <update id="updateProgress">
        update search_task
        set progress = #{progress},
            gmt_modified = now()
        where id = #{id}
    </update>

    <update id="updateStatus">
        update search_task
        set status = #{status},
            end_time = #{endTime},
            <if test="filePath != null and filePath != ''">
                file_path = #{filePath},
            </if>
            gmt_modified = now()
        where id = #{id}
    </update>

    <update id="updateStartStatus">
        update search_task
        set status = #{status},
            start_time = #{startTime},
            gmt_modified = now()
        where id = #{id}
    </update>

</mapper>
